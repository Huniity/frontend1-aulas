<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Anton&display=swap" rel="stylesheet">
    <title>SignUp - Padel Social Club</title>
    <link rel="stylesheet" href="./styles/homepage.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script> <!-- Include SweetAlert2 -->
</head>

<body>
<shared-navbar></shared-navbar>
    <div class="container">
        <main class="feed">
            <shared-top-menu></shared-top-menu>
            <hr>
            <div class="signup-box">
                <h2>Create Your Account</h2>
                <form id="sign-form">
                    <input type="text" id="username" placeholder="User Name" required style="padding-left: 20px; max-width: 480px"/>
                    <input type="text" id="f_name" placeholder="First Name" required style="padding-left: 20px; max-width: 480px"/>
                    <input type="text" id="l_name" placeholder="Last Name" required style="padding-left: 20px; max-width: 480px"/>
                    <input type="text" id="email" placeholder="Email" required style="padding-left: 20px; max-width: 480px"/>
                    <input type="password" id="password" placeholder="Password" required style="padding-left: 20px; max-width: 480px"/>
                    <select id="main_hand" required style="padding-left: 20px; max-width: 500px">
                        <option value="">Main Hand</option>
                        <option value="left">ðŸ‘‹ Left</option>
                        <option value="right">ðŸ‘‹ Right</option>
                    </select>
                    <input type="text" id="tags"
                        placeholder="Tags (Racket, Top, Match played, Wins and Losses, streaks...)" style="padding-left: 20px; max-width: 480px"/>
                    <input type="text" id="groups" placeholder="Your Den (Groups, Academy, Club, School, Team...)" style="padding-left: 20px; max-width: 480px"/>
                    <button type="submit">Sign Up</button>
                    <p>Already have an account? <a href="./signin.html">Sign in</a></p>
                </form>
            </div>
            <div class="users-container"></div>
        </main>
    </div>
<shared-footer></shared-footer>
<script src="./scripts/users_module.js" type="module" defer></script>
<script src="./scripts/shared_components.js" defer></script>
<script type="module">
    import { createUser } from "./scripts/users_module.js";

    const Toast = Swal.mixin({
        toast: true,
        position: "top",
        showConfirmButton: false,
        timer: 3000,
        timerProgressBar: true,
        didOpen: (toast) => {
            toast.onmouseenter = Swal.stopTimer;
            toast.onmouseleave = Swal.resumeTimer;
        }
    });

    document.addEventListener("DOMContentLoaded", () => {
        const signForm = document.querySelector("#sign-form");

        signForm.addEventListener("submit", async (e) => {
            e.preventDefault();

            const username = document.querySelector("#username").value;
            const f_name = document.querySelector("#f_name").value;
            const l_name = document.querySelector("#l_name").value;
            const email = document.querySelector("#email").value;
            const password = document.querySelector("#password").value;
            const main_hand = document.querySelector("#main_hand").value;
            const tags = document.querySelector("#tags").value.split(",").map(tag => tag.trim());
            const groups = document.querySelector("#groups").value.split(",").map(group => group.trim());

            const newUser = {
                username,
                f_name,
                l_name,
                email,
                password,
                main_hand,
                tags,
                groups,
                avatar: `https://robohash.org/${Math.floor(Math.random() * 1000)}.png`,
                created_at: new Date().toISOString(),
            };

            try {
                await createUser(newUser);
                Toast.fire({
                    icon: "success",
                    title: "Your account has been created successfully!"
                });
                setTimeout(() => {
                    window.location.href = "./signin.html";
                }, 3000);
            } catch (error) {
                console.error("Error creating account:", error);
                Toast.fire({
                    icon: "error",
                    title: "Failed to create account. Please try again."
                });
            }
        });
    });
</script>
</body>
</html>